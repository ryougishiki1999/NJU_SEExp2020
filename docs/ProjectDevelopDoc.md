# 项目研发报告

撰写人：施超烜 171860616@qq.com

## 项目介绍

### 项目任务

本组项目为完成一个基于clang/llvm实现的，通过静态分析手段实现缺陷检测的跨平台C++软件。

#### 核心功能

通过将逻辑嵌入到clang的流程中实现我们的软件，我们的软件核心框架本质上就是一个基于clang tools开发的软件，能够在clang运行的逻辑下执行我们自己的缺陷检测。

软件能够检测的缺陷类型为：内存泄漏（Memory Leak）、内存重复释放（Double Free）、内存释放后使用（Use After Free）、空指针解引用（Null Pointer Dereference）、除零\模零（Div Zero\Mod Zero）、数组溢出（Array Out Of Bound）以及类成员未初始化（Uninit Object）。

同时软件支持专家模式，通过调用clang static analyzer的方式进行专家模式的缺陷检测。

#### 交互式命令行

在命令行软件中，支持交互式命令行进行分析（REPL），用户能够通过交互式命令行进行执行参数的设置并进行检查和结果的查看，交互性更好。

#### 图形界面

图形界面版本囊括了命令行版本的所有功能，能够方便快捷的自定义配置检测参数，同时支持中英文转换，并提供了历史检测记录的支持。图形界面版本还支持从项目文件夹中自动检测```compile_commands.json```文件，并可以本地查看选项详细说明，并提供了进度条以便显示了解检测进度。最后，图形界面链接了我们的官网，随时查看相关手册。

### 研发过程

项目自2020.3月启动，项目组开始进行需求分析，并进行静态分析和缺陷检测的相关知识的学习，同时开始熟悉助教提供的分析框架。在经过小组成员的提议和讨论后，项目组觉得抛弃助教提供的框架，转而基于clang static analyzer的符号执行引擎进行开发。

之后进行为期三个月的项目开发核心流程，项目采用演化模型开发，项目开发过程共由三个周期组成，每个周期都有完整的需求分析->设计->编码->测试的过程。

2020.6月末，进行项目的文档整理和答辩材料准备。

## 项目组介绍

### 成员介绍

指导助教：何杰煊。项目组成员共5人，组长程珂，组员陈昊东、施超烜、吴晓阳、周若衡。

### 分工说明

- 第一周期
  - 程珂
    - 第一周期需求分析说明书的编写，DivModZeroChecker的设计
    - DivModZeroChecker的开发(负责除0，模0缺陷的检测)
    - DivModZeroChecker 测试用例的编写
  - 陈昊东
    - MemoryChecker与项目核心框架的设计
    - MemoryChecker与项目核心框架的开发（负责内存泄漏、内存重复释放、内存释放后使用的检测）
    - MemoryChecker与核心框架测试用例的编写
  - 施超烜
    - DeferenceChecker的设计
    - DeferenceChecker的开发(负责空指针解引用缺陷的检测)
    - DeferenceChecker测试用例的编写
  - 吴晓阳
    - JsonProc 与 DiagJsonTransform 模块的设计与实现并编写相应测试用例
  - 周若衡
    - UninitObjChecker 的设计
    - UninitObjChecker的开发(负责未初始化结构体缺陷的检测)
    - UninitObjChecker测试用例的编写
- 第二周期
  - 程珂
    - 第二周期需求分析说明书的编写
    - Gui图形界面的设计，实现并编写测试指南
    - Gui版本用户手册的编写
  - 陈昊东
    - REPL(交互式命令行)模块设计，实现并编写测试用例
    - 核心框架的维护与修复
    - 命令行版本用户手册的编写
  - 施超烜
    - HTML输出报告的设计
    - HTMLPrinter模块的设计与实现
  - 吴晓阳
    - OutPutManager的设计与实现(负责控制输出格式与类型的模块)
    - JsonPrinter 与 TextPrinter 的设计与实现 
  - 周若衡
    - Statistics 模块的设计与实现
    - PreProcessor 模块的设计与实现
- 第三周前
  - 程珂
    - 第三周期需求说明书的编写，维护并拓展 Gui 模块的功能
    - 设计，实现了DirTreeDialog模块，ProcessDialog模块，History模块与HistoryDialog模块，集成进Gui模块中并编写了测试指南
  - 陈昊东
    - 核心框架的维护与性能增强
    - 修复大项目测试中出现的有关bug
  - 施超烜
    - 在linux下搭建项目运行环境，并对项目进行全方位的测试。通过分析万行，十万行，百万行级别的C++项目测试HiSA的缺陷检测能力，导出各项性能指标(时间代价，空间代价)，对遇到的bug导出bug报告并通告相关模块编写者进行修复
  - 吴晓阳
    - 官方网站的搭建
    - 修复大项目测试中出现的有关bug
  - 周若衡
    - ArrayBoundChecker (数组越界)的设计，实现与测试用例的编写
    - 修复大项目测试中出现的有关bug

## 项目里程碑

### 项目阶段进展

#### 第一周期 

- 需求分析
- 框架设计
- 检测器算法设计
- 输出Json模块设计
- 框架与检测器编码实现
- 编写测试用例
- 第一周期测试

#### 第二周期

- 需求分析
- 交互式命令行设计
- GUI图形界面设计
- 交互式命令行与GUI实现
- 输出模块扩展
- 核心框架与检测器的扩展与维护
- 编写交互式命令行测试用例与Gui测试指南
- 第二周期测试
- 编写用户手册

#### 第三周期

- 需求分析
- 核心框架增强设计与实现
- Gui界面功能增强设计与实现
- 官方网站搭建
- 核心框架维护与扩展
- 大规模C/C++项目检测
- Bug修复与性能优化
- 编写开发者手册

#### 结项 

- 准备答辩材料
- 整理文档

### 项目里程碑

2020.2.20 开始课堂知识的学习和小组组队

2020.3.26 开始学习相关知识

2020.4.3   第一周期开始

2020.5.7   第二周期开始

2020.5.27 第三周期开始

2020.6月末-7月初 文档整理和准备答辩材料

## 技术介绍

### 核心技术

clang static analyzer符号执行引擎

## 工具介绍

#### Visual Studio 2019：

1. llvm + clang 支持使用 visual studio 进行搭建

2. Windows 下C++ 开发使用的IDE，使用贯穿HiSA开发的全过程

#### Qt：

1. C++图形用户界面应用程序开发框架

2. 用于开发HiSA的图形界面，在第二，三周期内使用

#### CMake：

1. 跨平台的安装(编译)工具，可以用简单的语句来描述所有平台的安装(编译过程) 

2. 构建HiSA core 和 console 模块，使用贯穿HiSA开发的全过程

#### Doxygen

1. 开源跨平台的，以类似JavaDoc风格描述的文档系统

2. 用于通过项目中的规范注释生成api文档

#### OpenCppCoverage

1. 一个用于Windows下c++的开源代码覆盖测试工具

2. 用以测试HiSA各个模块的代码覆盖率，使用贯穿所有测试过程

#### Git

1. 一个开源的分布式版本控制系统

2. 用于HiSA开发过程中的版本控制，使用贯穿HiSA开发的全过程

#### Compiledb

1. 为基于GNU make 的构建系统生成Clang的编译数据库json文件的工具

2. 辅助用户在本地为待检测项目生成compile_commands.json 文件

#### Understand

1. 一款用以分析软件的工具，支持C++

2. 用以生成代码的流程图与序列图等，用以更高效地理解他人编写的代码

## 工作量统计

工作量统计数据可见[POW.md](../docs/POW.md)文件

## 项目变更记录

#### 需求变更

1. 输出方式：控制台输出缺陷报告的方式给用户的阅读和报告存储带来了困难
2. 命令行：只能通过控制台一次性键入完整命令的交互方式不够灵活方便，极大降低了用户的交互体验
3. 代码结构：console 和 core 的代码混合在一起，为项目的构建和拓展带来了困难
4. 官方网站：项目缺乏一个提供用户查阅用户手册，开发者手册与API文档的网站
5. Checker：由于相关开发者对结构体未初始化缺陷的理解存在误差，导致后期测试的过程中 `UninitObjectChecker` 的表现不理想

#### 解决方案

1. 增加了 `html`，`json`，`text`方式的输出，方便用户查阅和存储检测结果。html格式的报告支持用户直接跳转到缺陷代码所在位置，提高了用户的使用体验。json 和 text的输出方便用户将缺陷报告集成进他们的工作流中
2. 增加了交互式命令行模块与Gui图形界面模块，方便用户进行自定义检测设置和查看帮助信息，拓展了原命令行的功能，给用户提供更好的交互体验
3. 将console 与 core 分离为两个模块
4. 开发官方网站，提供HiSA项目介绍，github链接，各个版本的下载资源和各种使用手册的在线查阅
5. 新增 `ArrayBoundChecker`负责数组越界缺陷的检测，并由原 `UninitObjectChecker` 的开发者进行设计和实现 

## 项目管理

### 项目管理

项目组全体开发成员通过github进行代码的托管，每个周期进行项目的测试，达到版本更迭的作用

### 过程管理

项目开发过程中，每周进行小组会议，讨论上周工作进度与下周计划，并且会在github上上传会议记录

### 质量管理

代码编写统一编码风格，统一注释格式以达到注释要求，每个周期进行测试保证代码的质量与功能完成度。